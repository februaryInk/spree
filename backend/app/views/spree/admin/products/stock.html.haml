= render partial: 'spree/admin/shared/product_tabs', locals: {current: :stock}
= render partial: 'spree/admin/shared/error_messages', locals: { target: @product }
- if can? :create, Spree::StockMovement
  #add_stock_form.panel.panel-default
    = render 'add_stock_form'
.panel.panel-default
  %table#listing_product_stock.table.table-bordered
    %thead
      %tr{"data-hook" => "admin_product_stock_management_index_headers"}
        %th{:colspan => "2"}= Spree.t(:variant)
        %th{:colspan => "3"}= Spree.t(:stock_location_info)
    %tbody
      - @variants.each do |variant|
        - if variant.stock_items.present?
          %tr{"data-hook" => "admin_product_stock_management_index_rows", :id => "#{spree_dom_id variant}"}
            %td.image.text-center
              - if variant.images.present?
                = image_tag variant.images.first.attachment.url(:mini)
            %td
              = variant.sku_and_options_text
              = form_tag admin_product_variants_including_master_path(@product, variant, format: :js), method: :put, class: 'toggle_variant_track_inventory' do
                .checkbox
                  = label_tag "track_inventory_#{ variant.id }" do
                    = check_box_tag 'track_inventory', 1, variant.track_inventory?,            |
                      class: 'track_inventory_checkbox', id: "track_inventory_#{ variant.id }" |
                    = Spree.t(:track_inventory)
                    = hidden_field_tag 'variant[track_inventory]', variant.track_inventory?, |
                      class: 'variant_track_inventory',                                      |
                      id: "variant_track_inventory_#{variant.id}"                            |
              - end if can?(:update, @product) && can?(:update, variant)
            %td.stock_location_info{:colspan => "3"}
              %table.table.table-bordered.no-marginb
                %thead
                  %th= Spree.t(:stock_location)
                  %th.text-center= Spree.t(:count_on_hand)
                  %th.text-center= Spree.t(:backorderable)
                  %th.actions.text-center
                %tbody
                  - variant.stock_items.each do |item|
                    - next unless @stock_locations.include?(item.stock_location)
                    %tr{:id => "stock-item-#{item.id}"}
                      %td= item.stock_location.name
                      %td.text-center= item.count_on_hand
                      %td.text-center
                        = form_tag admin_stock_item_path(item), method: :put, class: 'toggle_stock_item_backorderable' do
                          = check_box_tag 'stock_item[backorderable]', true,         |
                            item.backorderable?,                                     |
                            class: 'stock_item_backorderable',                       |
                            id: "stock_item_backorderable_#{item.stock_location.id}" |
                        - end if can? :update, item
                      %td.actions.actions-1.text-center
                        = link_to_with_icon('delete', Spree.t(:remove), [:admin, item], method: :delete, remote: true, class: 'icon_link btn btn-danger btn-sm', data: { action: :remove, confirm: Spree.t(:are_you_sure) }, no_text: true) if can? :destroy, item
